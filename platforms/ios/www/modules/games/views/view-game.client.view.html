<ion-view>
    <ion-content>
        <section data-ng-controller="GamesController" data-ng-init="findOne()">
            <div class="page-header">
                <h1>{{game.sport_type.name}}
                    <span class="pull-right">
                        <span data-ng-if="!game.game_result">Игра не окончена</span>

                        <div data-ng-if="game.can_follow">
                            <button class="btn btn-primary" data-ng-click="follow()">
                                follow
                            </button>
                        </div>
                        <div data-ng-if="!game.can_follow">
                            <button class="btn btn-danger" data-ng-click="follow()">
                                unfollow
                            </button>
                        </div>
                    </span>

                </h1>
            </div>
            <div class="lead">
                <p>Дата: {{game.game_date | date: 'mediumDate'}}</p>

                <p>Подписчики: {{game.subscribers.length}}</p>

                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        Сторона А
                        <p data-ng-repeat="member in game.first_players">
                            <a data-ng-href="/#!/profiles/{{member._id}}">{{member.displayName}}</a>
                        </p>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        Сторона Б
                        <p data-ng-repeat="member in game.second_players">
                            <a data-ng-href="/#!/profiles/{{member._id}}">{{member.displayName}}</a>
                        </p>
                    </div>
                </div>
            </div>
            <div>
                <div data-ng-if="game.user_can_cancel_and_result && !game.game_result">
                    <button class="btn btn-warning" data-ng-click="cancel_game()">cancel game</button>
                    <hr/>
                    <div class="form-group">
                        <div class="col-md-6 col-sm-6 col-xs-6">
                            <label class="control-label" for="first_players">First players Score</label>

                            <div class="controls">
                                <input data-ng-model="player_score.first" type="text" class="form-control"
                                       placeholder="First players score" id="first_players"/>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-6">
                            <label class="control-label" for="second_players">Second players Score</label>

                            <div class="controls">
                                <input data-ng-model="player_score.second" type="text" class="form-control"
                                       placeholder="Second players score" id="second_players"/>
                            </div>
                        </div>
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <button class="btn btn-success" data-ng-click="game_result()">enter game result</button>
                        </div>
                    </div>
                </div>
                <div data-ng-if="game.user_can_confirm">
                    <button class="btn btn-success" data-ng-click="confirm_result()">confirm game result</button>
                </div>
                <div data-ng-if="game.game_result && !game.game_result.canceled">
                    <p>Счет {{game.game_result.first_players_score}}:{{game.game_result.second_players_score}}</p>
                </div>
                <div data-ng-if="game.game_result.canceled">
                    <h4>Игра отменена</h4>
                </div>
                <div data-ng-if="game.game_result.resulted && !game.game_result.confirmed">
                    <h4>Ожидание подтверждения результата</h4>
                </div>
                <div data-ng-if="game.game_result.confirmed">
                    <h4>Результат подтвержден</h4>
                </div>
            </div>
            <div>
                Комментарии:
                <div data-ng-repeat="comment in game.comments">
                    <small>
                        <em>
                            <span data-ng-bind="comment.created | date: 'mediumDate'"></span>
                            <a data-ng-href="/#!/profiles/{{comment.user}}">{{comment.user_displayName}}</a>
                        </em>
                    </small>
                    <small data-ng-bind="comment.content"></small>
                    <button data-ng-if="comment.user === authentication.user._id"
                            class="btn btn-sm btn-danger"
                            data-ng-click="remove_comment(comment._id)">x
                    </button>
                </div>
                <div data-ng-if="!comments.length">
                    Нет комментариев
                </div>
                <div>
                    <input type="text" id="new_comment" data-ng-model="new_comment_content"/>
                    <label for="new_comment">
                        <button data-ng-click="add_comment()">Добавить</button>
                    </label>
                </div>
            </div>

        </section>
    </ion-content>
</ion-view>
