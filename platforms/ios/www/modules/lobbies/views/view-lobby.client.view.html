<ion-view>
    <ion-content>
        <section data-ng-controller="LobbiesController" data-ng-init="findOne()">
            <h1>{{error}}</h1>

            <div data-ng-if="!error">
                <div class="page-header">
                    <h1 data-ng-bind="lobby.sport_type.name"></h1>
                </div>
                <div class="pull-right">
                    <a class="btn btn-default" href="/#!/lobbies/{{lobby._id}}/create">
                        <i class="glyphicon glyphicon-star-empty"></i>
                    </a>
                </div>
                <div class="pull-right"
                     data-ng-show="((authentication.user) && (authentication.user._id == lobby.admin._id) && !lobby.game)">

                    <a class="btn btn-primary" href="/#!/lobbies/{{lobby._id}}/edit">
                        <i class="glyphicon glyphicon-edit"></i>
                    </a>
                    <a class="btn btn-primary" data-ng-click="remove();">
                        <i class="glyphicon glyphicon-trash"></i>
                    </a>
                </div>
                <div class="lead">
                    <p>Статус: {{lobby.game_started ? 'Игра началась' : !lobby.game_can_start ? 'В ожидании участников'
                        : 'Готово'}}</p>

                    <p>Адрес: {{lobby.address}}</p>

                    <p>Стоимость игры: {{lobby.price}}</p>

                    <p>Конец регистрации: {{lobby.end_date | date: 'mediumDate'}}</p>

                    <p>Дата игры: {{lobby.game_date | date: 'mediumDate'}}</p>

                    <p>Публичная игра: {{lobby.public ? 'да' : 'нет'}}</p>

                    <p>Ранговая игра: {{lobby.ranked ? 'да' : 'нет'}}</p>

                    <p>Количество игроков: {{lobby.members.length}} из {{lobby.player_amount}}</p>

                    <p data-ng-if="lobby.game_requests.length">Приглашенные: <a
                            data-ng-href="/#!/profiles/{{request._id}}" data-ng-repeat="request in lobby.game_requests">
                        {{request.displayName}}{{$index < lobby.game_requests.length - 1 ? ',' : ''}}
                    </a></p>
                </div>
                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        Сторона А
                        <p data-ng-repeat="member in lobby.first_players">
                            <a data-ng-href="/#!/profiles/{{member._id}}">{{member.displayName}}
                                <span class="badge badge-primary" data-ng-if="lobby.admin._id === member._id">ADM</span>
                            </a>
                        </p>

                        <div data-ng-if="lobby.user_can_join_first_players && !lobby.game_started">
                            <button class="btn btn-primary" data-ng-click="join_lobby(1)">Take slot</button>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        Сторона Б
                        <p data-ng-repeat="member in lobby.second_players">
                            <a data-ng-href="/#!/profiles/{{member._id}}">{{member.displayName}}</a>
                            <span class="badge badge-primary" data-ng-if="lobby.admin._id === member._id">CAPT.</span>
                        </p>

                        <div data-ng-if="lobby.user_can_join_second_players && !lobby.game_started">
                            <button class="btn btn-primary" data-ng-click="join_lobby(2)">Take slot</button>
                        </div>
                    </div>
                </div>
                <div data-ng-if="!lobby.game_started">
                    <div data-ng-if="lobby.game_can_start && ((authentication.user) && (authentication.user._id == lobby.admin._id))">
                        <button class="btn btn-primary" data-ng-click="start_game()">Start game</button>
                    </div>
                </div>
                <div data-ng-if="lobby.game_started">
                    <a data-ng-href="/#!/games/{{lobby.game._id || lobby.game}}">Игра</a> уже началась
                </div>
            </div>
        </section>
    </ion-content>
</ion-view>